# ============================================================================
# DOCKER COMPOSE - CARGOCLICK WEB
# ============================================================================
# Servicios:
#   - PostgreSQL 16.x: Base de datos principal
#
# Comandos útiles:
#   docker-compose up -d          # Iniciar servicios en background
#   docker-compose down           # Detener servicios
#   docker-compose logs postgres  # Ver logs de PostgreSQL
#   docker-compose ps             # Ver estado de servicios
# ============================================================================

services:
  # --------------------------------------------------------------------------
  # POSTGRESQL 16
  # --------------------------------------------------------------------------
  postgres:
    image: postgres:16-alpine
    container_name: cargoclick-postgres
    restart: unless-stopped
    ports:
      - "5432:5432"
    environment:
      # Credenciales de base de datos (deben coincidir con .env)
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
      POSTGRES_DB: cargoclick_web_db
      # Configuración de performance
      POSTGRES_INITDB_ARGS: "-E UTF8 --locale=C"
    volumes:
      # Persistencia de datos (los datos sobreviven a reinicios)
      - postgres_data:/var/lib/postgresql/data
      # Scripts de inicialización (opcional)
      # - ./prisma/init:/docker-entrypoint-initdb.d
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U postgres"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - cargoclick-network

# ----------------------------------------------------------------------------
# VOLUMES (Persistencia de datos)
# ----------------------------------------------------------------------------
volumes:
  postgres_data:
    driver: local

# ----------------------------------------------------------------------------
# NETWORKS
# ----------------------------------------------------------------------------
networks:
  cargoclick-network:
    driver: bridge

# ============================================================================
# INSTRUCCIONES DE USO
# ============================================================================
#
# 1. INICIAR SERVICIOS:
#    docker-compose up -d
#
# 2. VERIFICAR QUE POSTGRESQL ESTÁ CORRIENDO:
#    docker-compose ps
#    # Debe mostrar "cargoclick-postgres" en estado "Up"
#
# 3. EJECUTAR MIGRACIONES DE PRISMA:
#    npx prisma migrate dev --name init_solicitudes
#
# 4. INSPECCIONAR LA BASE DE DATOS (con Prisma Studio):
#    npx prisma studio
#    # Abre interfaz visual en http://localhost:5555
#
# 5. DETENER SERVICIOS (sin eliminar datos):
#    docker-compose down
#
# 6. DETENER Y ELIMINAR DATOS:
#    docker-compose down -v
#
# 7. VER LOGS:
#    docker-compose logs -f postgres
#
# ============================================================================
# CONEXIÓN DESDE APLICACIÓN
# ============================================================================
# 
# En tu archivo .env:
# DATABASE_URL=postgresql://postgres:postgres@localhost:5432/cargoclick_web_db
#
# ============================================================================
